# Hubserver
---

env:
  NAME: hubserver
  IMAGE: pressly/hubserver
  REGISTRY: registry.x.pressly.io
  CONFIG: /data/etc/hubserver.conf
  HOST_PORT: 80
  CONTAINER_PORT: 3000
  USER: $USER
  FOO: "bar"

networks:
  local: # For testing purposes only
    env:
      CONFIG: /data/etc/hubserver-local.conf
    hosts:
      - docker@192.168.59.103
      - docker@192.168.59.103
      - localhost
      - localhost
      - docker@192.168.59.103
      - docker@192.168.59.103
  dev:
    hosts:
      - ubuntu@betabox.x.pressly.io
  beta:
    hosts:
      - ubuntu@betabox.x.pressly.io:22
  prod:
    hosts:
      - ubuntu@betabox.x.pressly.io

commands:
  foo:
    exec: echo $FOO

  ping:
    exec: uname -a

  date:
    exec: date

  sleep:
    exec: sleep 0.$RANDOM

  ps:
    desc: Container list
    exec: sudo docker ps

  hello:
    desc: Say something..
    script: ./scripts/hello.sh

  # hmm.. does yaml parser give us comments too..?
  # then we could use that for the desc instead..
  provision:
    desc: Provision the container host OS
    script: ./scripts/docker/provision.sh

  build:
    desc: Build docker image
    script: ./scripts/docker/build.sh

  run:
    desc: Run container
    exec: sudo docker run --name $NAME -d -p $PORT \
          -v $CONFIG:/etc/hubserver.conf $IMAGE

targets:
  test:
    - ping
    - date
    - sleep
    - ping
    - date
    - sleep
    - ping
    - date
  deploy:
    - build
    - provision
    - run
