# Hubserver
---

hosts:
  local: # For testing purposes only
    - localhost
    - localhost
    - localhost
    - localhost
    - localhost
  dev:
    - ubuntu@betabox.x.pressly.io
  beta:
    - betabox.x.pressly.io:22
  prod:
    - ubuntu@betabox.x.pressly.io

env:
  NAME: hubserver
  IMAGE: pressly/hubserver
  REGISTRY: registry.x.pressly.io
  CONFIG: /data/etc/hubserver.conf
  HOST_PORT: 80
  CONTAINER_PORT: 3000
  USER: $USER

commands:
  ping:
    desc: Print OS name
    exec: uname -a

  ps:
    desc: Container list
    exec: sudo docker ps

  hello:
    desc: Say something..
    exec: echo 'hello dude.. sup?'

  # hmm.. does yaml parser give us comments too..?
  # then we could use that for the desc instead..
  provision:
    desc: Provision the container host OS
    script: ./scripts/docker/provision.sh

  build:
    desc: Build docker image
    script: ./scripts/docker/build.sh

  run:
    desc: Run container
    exec: sudo docker run --name $NAME -d -p $PORT \
          -v $CONFIG:/etc/hubserver.conf $IMAGE

targets:
  test:
    - ping
    - ps
    - hello
  deploy:
    - build
    - provision
    - run
